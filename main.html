<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ClawOff — Office Clawster · Clawbot for MS Office tasks</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
/* ClawOff — Office Clawster web interface (embedded) */

:root {
  --claw-bg: #0c0d10;
  --claw-surface: #14161c;
  --claw-surface2: #1a1d26;
  --claw-border: #2a2e3a;
  --claw-text: #e2e4e9;
  --claw-muted: #7a8090;
  --claw-accent: #4a9eff;
  --claw-accent-dim: #2d7ad4;
  --claw-success: #4ade80;
  --claw-warn: #facc15;
  --claw-danger: #f87171;
  --font-sans: "IBM Plex Sans", system-ui, sans-serif;
  --font-mono: "IBM Plex Mono", monospace;
}

*, *::before, *::after { box-sizing: border-box; }

body {
  margin: 0;
  background: var(--claw-bg);
  color: var(--claw-text);
  font-family: var(--font-sans);
  font-size: 14px;
  line-height: 1.5;
  min-height: 100vh;
}

.clawoff-wrap {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.clawoff-header {
  padding: 1rem 1.5rem;
  background: var(--claw-surface);
  border-bottom: 1px solid var(--claw-border);
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 1rem;
}

.clawoff-logo {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.clawoff-logo-icon {
  font-size: 1.4rem;
  color: var(--claw-accent);
}

.clawoff-logo-text {
  font-weight: 700;
  font-size: 1.3rem;
  letter-spacing: 0.02em;
}

.clawoff-tagline {
  color: var(--claw-muted);
  font-size: 0.9rem;
  margin: 0;
}

.clawoff-stats {
  display: flex;
  gap: 1rem;
  margin-left: auto;
}

.clawoff-stat {
  background: var(--claw-surface2);
  padding: 0.4rem 0.8rem;
  border-radius: 6px;
  font-size: 0.85rem;
  color: var(--claw-muted);
}

.clawoff-stat strong {
  color: var(--claw-accent);
  margin-right: 0.25rem;
}

.clawoff-main {
  flex: 1;
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 0;
  min-height: 0;
}

@media (max-width: 900px) {
  .clawoff-main { grid-template-columns: 1fr; }
}

.clawoff-sidebar {
  background: var(--claw-surface);
  border-right: 1px solid var(--claw-border);
  padding: 1rem;
  overflow-y: auto;
}

.clawoff-panel {
  margin-bottom: 1.5rem;
}

.clawoff-panel-title {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--claw-muted);
  margin: 0 0 0.75rem 0;
}

.clawoff-label {
  display: block;
  font-size: 0.8rem;
  color: var(--claw-muted);
  margin-bottom: 0.25rem;
}

.clawoff-input,
.clawoff-select {
  width: 100%;
  padding: 0.5rem 0.65rem;
  margin-bottom: 0.6rem;
  background: var(--claw-surface2);
  border: 1px solid var(--claw-border);
  border-radius: 6px;
  color: var(--claw-text);
  font-family: inherit;
  font-size: 0.9rem;
}

.clawoff-input:focus,
.clawoff-select:focus {
  outline: none;
  border-color: var(--claw-accent-dim);
}

.clawoff-input.mono,
.clawoff-select.mono,
.mono {
  font-family: var(--font-mono);
  font-size: 0.85rem;
}

.clawoff-btn {
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-family: inherit;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  border: 1px solid var(--claw-border);
  background: var(--claw-surface2);
  color: var(--claw-text);
  margin-right: 0.5rem;
  margin-bottom: 0.5rem;
}

.clawoff-btn:hover {
  background: var(--claw-border);
  color: var(--claw-text);
}

.clawoff-btn-primary {
  background: var(--claw-accent-dim);
  border-color: var(--claw-accent);
  color: #fff;
}

.clawoff-btn-primary:hover {
  background: var(--claw-accent);
}

.clawoff-hint {
  font-size: 0.75rem;
  color: var(--claw-muted);
  margin: 0.5rem 0 0 0;
}

.clawoff-panel-contract .clawoff-hint { margin-top: 0.25rem; }

.clawoff-content {
  padding: 1rem;
  overflow-y: auto;
  background: var(--claw-bg);
}

.clawoff-tabs {
  display: flex;
  gap: 0.25rem;
  margin-bottom: 1rem;
}

.clawoff-tab {
  padding: 0.5rem 1rem;
  border: 1px solid var(--claw-border);
  border-radius: 6px;
  background: var(--claw-surface);
  color: var(--claw-muted);
  font-family: inherit;
  font-size: 0.9rem;
  cursor: pointer;
}

.clawoff-tab:hover {
  color: var(--claw-text);
}

.clawoff-tab.active {
  background: var(--claw-accent-dim);
  border-color: var(--claw-accent);
  color: #fff;
}

.clawoff-tab-panel {
  display: none;
}

.clawoff-tab-panel.active {
  display: block;
}

.clawoff-list-title {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--claw-text);
  margin: 0 0 0.75rem 0;
}

.clawoff-toolbar {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.clawoff-filter {
  width: auto;
  min-width: 140px;
}

.clawoff-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.clawoff-list li {
  padding: 0.6rem 0.75rem;
  margin-bottom: 0.35rem;
  background: var(--claw-surface);
  border: 1px solid var(--claw-border);
  border-radius: 6px;
  font-size: 0.9rem;
}

.clawoff-list li .clawoff-doc-id,
.clawoff-list li .clawoff-cell-ref,
.clawoff-list li .clawoff-slot-id {
  font-family: var(--font-mono);
  font-size: 0.85rem;
  color: var(--claw-accent);
}

.clawoff-list li .clawoff-meta {
  font-size: 0.8rem;
  color: var(--claw-muted);
  margin-top: 0.25rem;
}

.clawoff-list li.processed .clawoff-meta { color: var(--claw-success); }

.clawoff-list-cells li {
  display: grid;
  grid-template-columns: 80px 60px 1fr;
  gap: 0.5rem;
  align-items: center;
}

.clawoff-report {
  background: var(--claw-surface);
  border: 1px solid var(--claw-border);
  border-radius: 8px;
  padding: 1rem;
  font-size: 0.85rem;
  white-space: pre-wrap;
  word-break: break-all;
  margin: 0;
}

.clawoff-footer {
  padding: 0.6rem 1.5rem;
  background: var(--claw-surface);
  border-top: 1px solid var(--claw-border);
  font-size: 0.8rem;
  color: var(--claw-muted);
}

.clawoff-footer p { margin: 0; }
  </style>
</head>
<body>
  <div class="clawoff-wrap">
    <header class="clawoff-header">
      <div class="clawoff-logo">
        <span class="clawoff-logo-icon" aria-hidden="true">▸</span>
        <span class="clawoff-logo-text">ClawOff</span>
      </div>
      <p class="clawoff-tagline">Office Clawster · Clawbot for Word, Excel, Outlook &amp; more</p>
      <div class="clawoff-stats">
        <span class="clawoff-stat"><strong id="stat-docs">0</strong> docs</span>
        <span class="clawoff-stat"><strong id="stat-cells">0</strong> cells</span>
        <span class="clawoff-stat"><strong id="stat-slots">0</strong> inbox</span>
        <span class="clawoff-stat"><strong id="stat-epoch">0</strong> epoch</span>
      </div>
    </header>

    <main class="clawoff-main">
      <aside class="clawoff-sidebar">
        <section class="clawoff-panel">
          <h2 class="clawoff-panel-title">Enqueue doc</h2>
          <label class="clawoff-label">Doc ID</label>
          <input type="text" id="input-doc-id" class="clawoff-input mono" placeholder="doc-..." maxlength="128" />
          <label class="clawoff-label">Task type</label>
          <select id="select-doc-type" class="clawoff-select">
            <option value="WORD_DOC">Word Document</option>
            <option value="EXCEL_SHEET">Excel Sheet</option>
            <option value="OUTLOOK_MAIL">Outlook Mail</option>
            <option value="POWERPOINT_SLIDE">PowerPoint Slide</option>
            <option value="ONENOTE_PAGE">OneNote Page</option>
            <option value="TEAMS_MSG">Teams Message</option>
            <option value="CALENDAR_EVENT">Calendar Event</option>
            <option value="CONTACT_ENTRY">Contact Entry</option>
            <option value="TASK_ITEM">Task Item</option>
            <option value="GENERIC_DOC">Generic Document</option>
          </select>
          <label class="clawoff-label">Payload (hashed)</label>
          <input type="text" id="input-payload" class="clawoff-input mono" placeholder="Optional or auto" />
          <button type="button" class="clawoff-btn clawoff-btn-primary" id="btn-enqueue">Enqueue doc</button>
        </section>

        <section class="clawoff-panel">
          <h2 class="clawoff-panel-title">Log sheet cell</h2>
          <label class="clawoff-label">Cell ref (e.g. A1, B2)</label>
          <input type="text" id="input-cell-ref" class="clawoff-input mono" placeholder="A1" maxlength="16" />
          <label class="clawoff-label">Sheet app (0–63)</label>
          <input type="number" id="input-sheet-app" class="clawoff-input" min="0" max="63" value="0" />
          <button type="button" class="clawoff-btn" id="btn-log-cell">Log cell</button>
        </section>

        <section class="clawoff-panel">
          <h2 class="clawoff-panel-title">Reserve inbox slot</h2>
          <label class="clawoff-label">Slot ID</label>
          <input type="text" id="input-slot-id" class="clawoff-input mono" placeholder="slot-..." maxlength="64" />
          <label class="clawoff-label">Inbox type (0–31)</label>
          <input type="number" id="input-inbox-type" class="clawoff-input" min="0" max="31" value="0" />
          <button type="button" class="clawoff-btn" id="btn-reserve">Reserve slot</button>
        </section>

        <section class="clawoff-panel">
          <h2 class="clawoff-panel-title">Actions</h2>
          <button type="button" class="clawoff-btn" id="btn-process">Process next doc</button>
          <button type="button" class="clawoff-btn" id="btn-bump-epoch">Bump epoch</button>
          <button type="button" class="clawoff-btn" id="btn-export">Export JSON</button>
          <button type="button" class="clawoff-btn" id="btn-clear">Clear all</button>
        </section>

        <section class="clawoff-panel clawoff-panel-contract">
          <h2 class="clawoff-panel-title">Contract (optional)</h2>
          <label class="clawoff-label">OfficeClawster address</label>
          <input type="text" id="input-contract-addr" class="clawoff-input mono" placeholder="0x..." />
          <p class="clawoff-hint">Paste deployed contract address for future read-only integration.</p>
        </section>
      </aside>

      <section class="clawoff-content">
        <div class="clawoff-tabs">
          <button type="button" class="clawoff-tab active" data-tab="docs">Doc queue</button>
          <button type="button" class="clawoff-tab" data-tab="cells">Sheet cells</button>
          <button type="button" class="clawoff-tab" data-tab="inbox">Inbox slots</button>
          <button type="button" class="clawoff-tab" data-tab="report">Report</button>
        </div>

        <div id="tab-docs" class="clawoff-tab-panel active">
          <h3 class="clawoff-list-title">Queued documents</h3>
          <div class="clawoff-toolbar">
            <select id="filter-doc-type" class="clawoff-select clawoff-filter">
              <option value="">All types</option>
              <option value="WORD_DOC">Word</option>
              <option value="EXCEL_SHEET">Excel</option>
              <option value="OUTLOOK_MAIL">Outlook</option>
              <option value="POWERPOINT_SLIDE">PowerPoint</option>
              <option value="GENERIC_DOC">Generic</option>
            </select>
            <select id="filter-processed" class="clawoff-select clawoff-filter">
              <option value="">All</option>
              <option value="pending">Pending only</option>
              <option value="processed">Processed only</option>
            </select>
          </div>
          <ul class="clawoff-list" id="list-docs"></ul>
        </div>

        <div id="tab-cells" class="clawoff-tab-panel">
          <h3 class="clawoff-list-title">Sheet cells</h3>
          <ul class="clawoff-list clawoff-list-cells" id="list-cells"></ul>
        </div>

        <div id="tab-inbox" class="clawoff-tab-panel">
          <h3 class="clawoff-list-title">Inbox slots</h3>
          <ul class="clawoff-list" id="list-inbox"></ul>
        </div>

        <div id="tab-report" class="clawoff-tab-panel">
          <h3 class="clawoff-list-title">Summary report</h3>
          <pre class="clawoff-report mono" id="report-content"></pre>
        </div>
      </section>
    </main>

    <footer class="clawoff-footer">
      <p>ClawOff · OfficeClawster · Clawbot for MS Office tasks · EVM compatible</p>
    </footer>
  </div>

  <script>
/**
 * ClawOff — Office Clawster web UI.
 * Doc queue, sheet cells, inbox slots. All logic embedded in this single HTML file.
 *
 * Task types: WORD_DOC, EXCEL_SHEET, OUTLOOK_MAIL, POWERPOINT_SLIDE, ONENOTE_PAGE,
 * ACCESS_DB, PUBLISHER_PUB, VISIO_DIAGRAM, PROJECT_PLAN, TEAMS_MSG, SHAREPOINT_ITEM,
 * GENERIC_DOC, CALENDAR_EVENT, CONTACT_ENTRY, TASK_ITEM.
 *
 * Actions: enqueue doc (with type and optional payload hash), log sheet cell (ref + sheet app),
 * reserve inbox slot, process next doc, bump epoch, export JSON, clear all.
 * Optional contract address field for future OfficeClawster.sol read-only integration.
 *
 * Data: docs[] (docId, enqueuedBy, docType, queueEpoch, payloadHash, processed),
 *       cells[] (cellRef, sheetApp, valueHash), slots[] (slotId, reservedBy, inboxType).
 * Report: extended view with by-type and by-sheet-app breakdown.
 */

(function () {
  'use strict';

  const TASK_TYPES = [
    'WORD_DOC', 'EXCEL_SHEET', 'OUTLOOK_MAIL', 'POWERPOINT_SLIDE', 'ONENOTE_PAGE',
    'ACCESS_DB', 'PUBLISHER_PUB', 'VISIO_DIAGRAM', 'PROJECT_PLAN', 'TEAMS_MSG',
    'SHAREPOINT_ITEM', 'GENERIC_DOC', 'CALENDAR_EVENT', 'CONTACT_ENTRY', 'TASK_ITEM', 'UNKNOWN'
  ];
  // In-memory state: docs (queue), cells (sheet ledger), slots (inbox registry), queueEpoch

  let docs = [];
  let cells = [];
  let slots = [];
  let queueEpoch = 0;
  let docIdSeq = 0;
  let slotIdSeq = 0;

  const statDocs = document.getElementById('stat-docs');
  const statCells = document.getElementById('stat-cells');
  const statSlots = document.getElementById('stat-slots');
  const statEpoch = document.getElementById('stat-epoch');
  const listDocs = document.getElementById('list-docs');
  const listCells = document.getElementById('list-cells');
  const listInbox = document.getElementById('list-inbox');
  const reportContent = document.getElementById('report-content');
  // Refs: stat-docs, stat-cells, stat-slots, stat-epoch; list-docs, list-cells, list-inbox; report-content

  function generateDocId() {
    return 'doc-' + Date.now() + '-' + (++docIdSeq) + '-' + Math.random().toString(36).slice(2, 8);
  }

  function generateSlotId() {
    return 'slot-' + (++slotIdSeq) + '-' + Math.random().toString(36).slice(2, 8);
  }

  function hash(s) {
    if (!s || !s.trim()) return '';
    let h = 0;
    const str = s.trim();
    for (let i = 0; i < str.length; i++) {
      h = ((h << 5) - h) + str.charCodeAt(i) | 0;
    }
    return (h >>> 0).toString(16);
  }

  function updateStats() {
    statDocs.textContent = docs.length;
    statCells.textContent = cells.length;
    statSlots.textContent = slots.length;
    statEpoch.textContent = queueEpoch;
  }

  function addDoc(docId, docType, payloadHash) {
    docs.push({
      docId: docId || generateDocId(),
      enqueuedBy: 'user',
      docType: docType || 'GENERIC_DOC',
      queueEpoch: queueEpoch,
      enqueuedAtMs: Date.now(),
      payloadHash: payloadHash || hash(docId || ''),
      processed: false
    });
    updateStats();
    renderDocs();
    renderReport();
  }

  function processNextDoc() {
    const pending = docs.find(d => !d.processed);
    if (pending) {
      pending.processed = true;
      updateStats();
      renderDocs();
      renderReport();
    }
  }

  function addCell(cellRef, sheetApp) {
    cells.push({
      cellRef: cellRef,
      sheetApp: Math.max(0, Math.min(63, sheetApp || 0)),
      loggedAtMs: Date.now(),
      valueHash: hash(cellRef)
    });
    updateStats();
    renderCells();
    renderReport();
  }

  function addSlot(slotId, inboxType) {
    slots.push({
      slotId: slotId || generateSlotId(),
      reservedBy: 'user',
      inboxType: Math.max(0, Math.min(31, inboxType || 0)),
      reservedAtMs: Date.now()
    });
    updateStats();
    renderInbox();
    renderReport();
  }

  function bumpEpoch() {
    queueEpoch++;
    updateStats();
    renderReport();
  }

  function getFilteredDocs() {
    let list = docs;
    const typeFilter = document.getElementById('filter-doc-type').value;
    const processedFilter = document.getElementById('filter-processed').value;
    if (typeFilter) list = list.filter(d => d.docType === typeFilter);
    if (processedFilter === 'pending') list = list.filter(d => !d.processed);
    if (processedFilter === 'processed') list = list.filter(d => d.processed);
    return list;
  }

  function renderDocs() {
    const list = getFilteredDocs();
    listDocs.innerHTML = list.map(d => `
      <li class="${d.processed ? 'processed' : ''}">
        <span class="clawoff-doc-id">${escapeHtml(d.docId)}</span>
        <span class="clawoff-meta">${d.docType} · Epoch ${d.queueEpoch} · ${d.processed ? 'Processed' : 'Pending'}</span>
      </li>
    `).join('');
  }

  function renderCells() {
    listCells.innerHTML = cells.map(c => `
      <li>
        <span class="clawoff-cell-ref">${escapeHtml(c.cellRef)}</span>
        <span>app ${c.sheetApp}</span>
        <span class="clawoff-meta">${c.valueHash}</span>
      </li>
    `).join('');
  }

  function renderInbox() {
    listInbox.innerHTML = slots.map(s => `
      <li>
        <span class="clawoff-slot-id">${escapeHtml(s.slotId)}</span>
        <span class="clawoff-meta">Type ${s.inboxType} · ${s.reservedBy}</span>
      </li>
    `).join('');
  }

  function buildReportShort() {
    const processed = docs.filter(d => d.processed).length;
    const pending = docs.length - processed;
    const byType = {};
    docs.forEach(d => { byType[d.docType] = (byType[d.docType] || 0) + 1; });
    let typeLines = '';
    for (const [k, v] of Object.entries(byType)) typeLines += `  ${k}: ${v}\n`;
    // Short report: doc counts, cells, slots, epoch, type breakdown
    return (
      `=== ClawOff Report ===\n` +
      `Docs queued: ${docs.length}\n` +
      `Processed: ${processed}  Pending: ${pending}\n` +
      `Cells logged: ${cells.length}\n` +
      `Inbox slots: ${slots.length}\n` +
      `Current epoch: ${queueEpoch}\n\n` +
      `By type:\n${typeLines || '  (none)\n'}`
    );
  }

  function buildReportExtended() {
    const processed = docs.filter(d => d.processed).length;
    const pending = docs.length - processed;
    const byType = {};
    docs.forEach(d => { byType[d.docType] = (byType[d.docType] || 0) + 1; });
    let typeLines = '';
    for (const [k, v] of Object.entries(byType)) typeLines += `  ${k}: ${v}\n`;
    const cellByApp = {};
    cells.forEach(c => { cellByApp[c.sheetApp] = (cellByApp[c.sheetApp] || 0) + 1; });
    let cellLines = '';
    for (const [k, v] of Object.entries(cellByApp)) cellLines += `  Sheet app ${k}: ${v} cells\n`;
    return (
      `=== ClawOff Extended Report ===\n` +
      `Generated: ${new Date().toISOString()}\n\n` +
      `Doc queue:\n  Total: ${docs.length}\n  Processed: ${processed}\n  Pending: ${pending}\n` +
      `By type:\n${typeLines || '  (none)\n'}\n` +
      `Sheet cells: ${cells.length} total\n${cellLines || '  (none)\n'}` +
      `Inbox slots: ${slots.length}\n` +
      `Current epoch: ${queueEpoch}\n`
    );
  }

  function renderReport() {
    reportContent.textContent = buildReportExtended();
  }
  // buildReportExtended: full report with timestamp, by-type, by-sheet-app, epoch

  function escapeHtml(s) {
    if (!s) return '';
    const div = document.createElement('div');
    div.textContent = s;
    return div.innerHTML;
  }
  // escapeHtml: prevent XSS when rendering user-provided docId, cellRef, slotId
  // exportJson: download JSON file with docs, cells, inbox; filename includes timestamp

  function exportJson() {
    // Build payload matching OfficeClawster export shape: version, epoch, docs, cells, inbox
    const payload = {
      version: '1.0.0-office',
      epoch: queueEpoch,
      docs: docs.map(d => ({
        id: d.docId,
        by: d.enqueuedBy,
        type: d.docType,
        epoch: d.queueEpoch,
        processed: d.processed,
        payloadHash: d.payloadHash
      })),
      cells: cells.map(c => ({ ref: c.cellRef, sheetApp: c.sheetApp, valueHash: c.valueHash })),
      inbox: slots.map(s => ({ slotId: s.slotId, by: s.reservedBy, inboxType: s.inboxType }))
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'clawoff_export_' + Date.now() + '.json';
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function clearAll() {
    if (!confirm('Clear all docs, cells, and inbox slots?')) return;
    // Reset all in-memory state and re-render
    docs = [];
    cells = [];
    slots = [];
    queueEpoch = 0;
    updateStats();
    renderDocs();
    renderCells();
    renderInbox();
    renderReport();
  }

